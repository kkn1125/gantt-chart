var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});var __publicField=(obj,key,value)=>__defNormalProp(obj,typeof key!="symbol"?key+"":key,value);__name(function(){const relList=document.createElement("link").relList;if(relList&&relList.supports&&relList.supports("modulepreload"))return;for(const link of document.querySelectorAll('link[rel="modulepreload"]'))processPreload(link);new MutationObserver(mutations=>{for(const mutation of mutations)if(mutation.type==="childList")for(const node of mutation.addedNodes)node.tagName==="LINK"&&node.rel==="modulepreload"&&processPreload(node)}).observe(document,{childList:!0,subtree:!0});function getFetchOpts(link){const fetchOpts={};return link.integrity&&(fetchOpts.integrity=link.integrity),link.referrerPolicy&&(fetchOpts.referrerPolicy=link.referrerPolicy),link.crossOrigin==="use-credentials"?fetchOpts.credentials="include":link.crossOrigin==="anonymous"?fetchOpts.credentials="omit":fetchOpts.credentials="same-origin",fetchOpts}__name(getFetchOpts,"getFetchOpts");function processPreload(link){if(link.ep)return;link.ep=!0;const fetchOpts=getFetchOpts(link);fetch(link.href,fetchOpts)}__name(processPreload,"processPreload")},"polyfill")();var boxicons={exports:{}};(function(module,exports){(function(t,e,n,r,o){if("customElements"in n)o();else{if(n.AWAITING_WEB_COMPONENTS_POLYFILL)return void n.AWAITING_WEB_COMPONENTS_POLYFILL.then(o);var a=n.AWAITING_WEB_COMPONENTS_POLYFILL=f();a.then(o);var i=n.WEB_COMPONENTS_POLYFILL||"//cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/2.0.2/webcomponents-bundle.js",s=n.ES6_CORE_POLYFILL||"//cdnjs.cloudflare.com/ajax/libs/core-js/2.5.3/core.min.js";"Promise"in n?c(i).then(function(){a.isDone=!0,a.exec()}):c(s).then(function(){c(i).then(function(){a.isDone=!0,a.exec()})})}function f(){var t2=[];return t2.isDone=!1,t2.exec=function(){t2.splice(0).forEach(function(t3){t3()})},t2.then=function(e2){return t2.isDone?e2():t2.push(e2),t2},t2}__name(f,"f");function c(t2){var e2=f(),n2=r.createElement("script");return n2.type="text/javascript",n2.readyState?n2.onreadystatechange=function(){n2.readyState!="loaded"&&n2.readyState!="complete"||(n2.onreadystatechange=null,e2.isDone=!0,e2.exec())}:n2.onload=function(){e2.isDone=!0,e2.exec()},n2.src=t2,r.getElementsByTagName("head")[0].appendChild(n2),n2.then=e2.then,n2}__name(c,"c")})(0,0,window,document,function(){var e;e=__name(function(){return function(t){var e2={};function n(r){if(e2[r])return e2[r].exports;var o=e2[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return __name(n,"n"),n.m=t,n.c=e2,n.d=function(t2,e3,r){n.o(t2,e3)||Object.defineProperty(t2,e3,{enumerable:!0,get:r})},n.r=function(t2){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t2,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t2,"__esModule",{value:!0})},n.t=function(t2,e3){if(1&e3&&(t2=n(t2)),8&e3||4&e3&&typeof t2=="object"&&t2&&t2.__esModule)return t2;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t2}),2&e3&&typeof t2!="string")for(var o in t2)n.d(r,o,(function(e4){return t2[e4]}).bind(null,o));return r},n.n=function(t2){var e3=t2&&t2.__esModule?function(){return t2.default}:function(){return t2};return n.d(e3,"a",e3),e3},n.o=function(t2,e3){return Object.prototype.hasOwnProperty.call(t2,e3)},n.p="",n(n.s=5)}([function(t,e2){t.exports=function(t2){var e3=[];return e3.toString=function(){return this.map(function(e4){var n=function(t3,e5){var n2,r=t3[1]||"",o=t3[3];if(!o)return r;if(e5&&typeof btoa=="function"){var a=(n2=o,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n2))))+" */"),i=o.sources.map(function(t4){return"/*# sourceURL="+o.sourceRoot+t4+" */"});return[r].concat(i).concat([a]).join(`
`)}return[r].join(`
`)}(e4,t2);return e4[2]?"@media "+e4[2]+"{"+n+"}":n}).join("")},e3.i=function(t3,n){typeof t3=="string"&&(t3=[[null,t3,""]]);for(var r={},o=0;o<this.length;o++){var a=this[o][0];typeof a=="number"&&(r[a]=!0)}for(o=0;o<t3.length;o++){var i=t3[o];typeof i[0]=="number"&&r[i[0]]||(n&&!i[2]?i[2]=n:n&&(i[2]="("+i[2]+") and ("+n+")"),e3.push(i))}},e3}},function(t,e2,n){var r=n(3);t.exports=typeof r=="string"?r:r.toString()},function(t,e2,n){var r=n(4);t.exports=typeof r=="string"?r:r.toString()},function(t,e2,n){(t.exports=n(0)(!1)).push([t.i,"@-webkit-keyframes spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@keyframes spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@-webkit-keyframes burst{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}90%{-webkit-transform:scale(1.5);transform:scale(1.5);opacity:0}}@keyframes burst{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}90%{-webkit-transform:scale(1.5);transform:scale(1.5);opacity:0}}@-webkit-keyframes flashing{0%{opacity:1}45%{opacity:0}90%{opacity:1}}@keyframes flashing{0%{opacity:1}45%{opacity:0}90%{opacity:1}}@-webkit-keyframes fade-left{0%{-webkit-transform:translateX(0);transform:translateX(0);opacity:1}75%{-webkit-transform:translateX(-20px);transform:translateX(-20px);opacity:0}}@keyframes fade-left{0%{-webkit-transform:translateX(0);transform:translateX(0);opacity:1}75%{-webkit-transform:translateX(-20px);transform:translateX(-20px);opacity:0}}@-webkit-keyframes fade-right{0%{-webkit-transform:translateX(0);transform:translateX(0);opacity:1}75%{-webkit-transform:translateX(20px);transform:translateX(20px);opacity:0}}@keyframes fade-right{0%{-webkit-transform:translateX(0);transform:translateX(0);opacity:1}75%{-webkit-transform:translateX(20px);transform:translateX(20px);opacity:0}}@-webkit-keyframes fade-up{0%{-webkit-transform:translateY(0);transform:translateY(0);opacity:1}75%{-webkit-transform:translateY(-20px);transform:translateY(-20px);opacity:0}}@keyframes fade-up{0%{-webkit-transform:translateY(0);transform:translateY(0);opacity:1}75%{-webkit-transform:translateY(-20px);transform:translateY(-20px);opacity:0}}@-webkit-keyframes fade-down{0%{-webkit-transform:translateY(0);transform:translateY(0);opacity:1}75%{-webkit-transform:translateY(20px);transform:translateY(20px);opacity:0}}@keyframes fade-down{0%{-webkit-transform:translateY(0);transform:translateY(0);opacity:1}75%{-webkit-transform:translateY(20px);transform:translateY(20px);opacity:0}}@-webkit-keyframes tada{0%{-webkit-transform:scaleX(1);transform:scaleX(1)}10%,20%{-webkit-transform:scale3d(.95,.95,.95) rotate(-10deg);transform:scale3d(.95,.95,.95) rotate(-10deg)}30%,50%,70%,90%{-webkit-transform:scaleX(1) rotate(10deg);transform:scaleX(1) rotate(10deg)}40%,60%,80%{-webkit-transform:scaleX(1) rotate(-10deg);transform:scaleX(1) rotate(-10deg)}to{-webkit-transform:scaleX(1);transform:scaleX(1)}}@keyframes tada{0%{-webkit-transform:scaleX(1);transform:scaleX(1)}10%,20%{-webkit-transform:scale3d(.95,.95,.95) rotate(-10deg);transform:scale3d(.95,.95,.95) rotate(-10deg)}30%,50%,70%,90%{-webkit-transform:scaleX(1) rotate(10deg);transform:scaleX(1) rotate(10deg)}40%,60%,80%{-webkit-transform:rotate(-10deg);transform:rotate(-10deg)}to{-webkit-transform:scaleX(1);transform:scaleX(1)}}.bx-spin,.bx-spin-hover:hover{-webkit-animation:spin 2s linear infinite;animation:spin 2s linear infinite}.bx-tada,.bx-tada-hover:hover{-webkit-animation:tada 1.5s ease infinite;animation:tada 1.5s ease infinite}.bx-flashing,.bx-flashing-hover:hover{-webkit-animation:flashing 1.5s infinite linear;animation:flashing 1.5s infinite linear}.bx-burst,.bx-burst-hover:hover{-webkit-animation:burst 1.5s infinite linear;animation:burst 1.5s infinite linear}.bx-fade-up,.bx-fade-up-hover:hover{-webkit-animation:fade-up 1.5s infinite linear;animation:fade-up 1.5s infinite linear}.bx-fade-down,.bx-fade-down-hover:hover{-webkit-animation:fade-down 1.5s infinite linear;animation:fade-down 1.5s infinite linear}.bx-fade-left,.bx-fade-left-hover:hover{-webkit-animation:fade-left 1.5s infinite linear;animation:fade-left 1.5s infinite linear}.bx-fade-right,.bx-fade-right-hover:hover{-webkit-animation:fade-right 1.5s infinite linear;animation:fade-right 1.5s infinite linear}",""])},function(t,e2,n){(t.exports=n(0)(!1)).push([t.i,'.bx-rotate-90{transform:rotate(90deg);-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=1)"}.bx-rotate-180{transform:rotate(180deg);-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2)"}.bx-rotate-270{transform:rotate(270deg);-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=3)"}.bx-flip-horizontal{transform:scaleX(-1);-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)"}.bx-flip-vertical{transform:scaleY(-1);-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)"}',""])},function(t,e2,n){n.r(e2),n.d(e2,"BoxIconElement",function(){return g});var r,o,a,i,s=n(1),f=n.n(s),c=n(2),l=n.n(c),m=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t2){return typeof t2}:function(t2){return t2&&typeof Symbol=="function"&&t2.constructor===Symbol&&t2!==Symbol.prototype?"symbol":typeof t2},u=function(){function t2(t3,e3){for(var n2=0;n2<e3.length;n2++){var r2=e3[n2];r2.enumerable=r2.enumerable||!1,r2.configurable=!0,"value"in r2&&(r2.writable=!0),Object.defineProperty(t3,r2.key,r2)}}return __name(t2,"t"),function(e3,n2,r2){return n2&&t2(e3.prototype,n2),r2&&t2(e3,r2),e3}}(),d=(o=(r=Object).getPrototypeOf||function(t2){return t2.__proto__},a=r.setPrototypeOf||function(t2,e3){return t2.__proto__=e3,t2},i=(typeof Reflect>"u"?"undefined":m(Reflect))==="object"?Reflect.construct:function(t2,e3,n2){var r2,o2=[null];return o2.push.apply(o2,e3),r2=t2.bind.apply(t2,o2),a(new r2,n2.prototype)},function(t2){var e3=o(t2);return a(t2,a(function(){return i(e3,arguments,o(this).constructor)},e3))}),p=window,b={},y=document.createElement("template"),h=__name(function(){return!!p.ShadyCSS},"h");y.innerHTML=`
<style>
:host {
  display: inline-block;
  font-size: initial;
  box-sizing: border-box;
  width: 24px;
  height: 24px;
}
:host([size=xs]) {
    width: 0.8rem;
    height: 0.8rem;
}
:host([size=sm]) {
    width: 1.55rem;
    height: 1.55rem;
}
:host([size=md]) {
    width: 2.25rem;
    height: 2.25rem;
}
:host([size=lg]) {
    width: 3.0rem;
    height: 3.0rem;
}

:host([size]:not([size=""]):not([size=xs]):not([size=sm]):not([size=md]):not([size=lg])) {
    width: auto;
    height: auto;
}
:host([pull=left]) #icon {
    float: left;
    margin-right: .3em!important;
}
:host([pull=right]) #icon {
    float: right;
    margin-left: .3em!important;
}
:host([border=square]) #icon {
    padding: .25em;
    border: .07em solid rgba(0,0,0,.1);
    border-radius: .25em;
}
:host([border=circle]) #icon {
    padding: .25em;
    border: .07em solid rgba(0,0,0,.1);
    border-radius: 50%;
}
#icon,
svg {
  width: 100%;
  height: 100%;
}
#icon {
    box-sizing: border-box;
} 
`+f.a+`
`+l.a+`
</style>
<div id="icon"></div>`;var g=d(function(t2){function e3(){(function(t4,e4){if(!(t4 instanceof e4))throw new TypeError("Cannot call a class as a function")})(this,e3);var t3=function(t4,e4){if(!t4)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e4||typeof e4!="object"&&typeof e4!="function"?t4:e4}(this,(e3.__proto__||Object.getPrototypeOf(e3)).call(this));return t3.$ui=t3.attachShadow({mode:"open"}),t3.$ui.appendChild(t3.ownerDocument.importNode(y.content,!0)),h()&&p.ShadyCSS.styleElement(t3),t3._state={$iconHolder:t3.$ui.getElementById("icon"),type:t3.getAttribute("type")},t3}return __name(e3,"e"),function(t3,e4){if(typeof e4!="function"&&e4!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e4);t3.prototype=Object.create(e4&&e4.prototype,{constructor:{value:t3,enumerable:!1,writable:!0,configurable:!0}}),e4&&(Object.setPrototypeOf?Object.setPrototypeOf(t3,e4):t3.__proto__=e4)}(e3,HTMLElement),u(e3,null,[{key:"getIconSvg",value:__name(function(t3,e4){var n2=this.cdnUrl+"/regular/bx-"+t3+".svg";return e4==="solid"?n2=this.cdnUrl+"/solid/bxs-"+t3+".svg":e4==="logo"&&(n2=this.cdnUrl+"/logos/bxl-"+t3+".svg"),n2&&b[n2]||(b[n2]=new Promise(function(t4,e5){var r2=new XMLHttpRequest;r2.addEventListener("load",function(){this.status<200||this.status>=300?e5(new Error(this.status+" "+this.responseText)):t4(this.responseText)}),r2.onerror=e5,r2.onabort=e5,r2.open("GET",n2),r2.send()})),b[n2]},"value")},{key:"define",value:__name(function(t3){t3=t3||this.tagName,h()&&p.ShadyCSS.prepareTemplate(y,t3),customElements.define(t3,this)},"value")},{key:"cdnUrl",get:__name(function(){return"//unpkg.com/boxicons@2.1.4/svg"},"get")},{key:"tagName",get:__name(function(){return"box-icon"},"get")},{key:"observedAttributes",get:__name(function(){return["type","name","color","size","rotate","flip","animation","border","pull"]},"get")}]),u(e3,[{key:"attributeChangedCallback",value:__name(function(t3,e4,n2){var r2=this._state.$iconHolder;switch(t3){case"type":(function(t4,e5,n3){var r3=t4._state;r3.$iconHolder.textContent="",r3.type&&(r3.type=null),r3.type=!n3||n3!=="solid"&&n3!=="logo"?"regular":n3,r3.currentName!==void 0&&t4.constructor.getIconSvg(r3.currentName,r3.type).then(function(t5){r3.type===n3&&(r3.$iconHolder.innerHTML=t5)}).catch(function(t5){console.error("Failed to load icon: "+r3.currentName+`
`+t5)})})(this,0,n2);break;case"name":(function(t4,e5,n3){var r3=t4._state;r3.currentName=n3,r3.$iconHolder.textContent="",n3&&r3.type!==void 0&&t4.constructor.getIconSvg(n3,r3.type).then(function(t5){r3.currentName===n3&&(r3.$iconHolder.innerHTML=t5)}).catch(function(t5){console.error("Failed to load icon: "+n3+`
`+t5)})})(this,0,n2);break;case"color":r2.style.fill=n2||"";break;case"size":(function(t4,e5,n3){var r3=t4._state;r3.size&&(r3.$iconHolder.style.width=r3.$iconHolder.style.height="",r3.size=r3.sizeType=null),n3&&!/^(xs|sm|md|lg)$/.test(r3.size)&&(r3.size=n3.trim(),r3.$iconHolder.style.width=r3.$iconHolder.style.height=r3.size)})(this,0,n2);break;case"rotate":e4&&r2.classList.remove("bx-rotate-"+e4),n2&&r2.classList.add("bx-rotate-"+n2);break;case"flip":e4&&r2.classList.remove("bx-flip-"+e4),n2&&r2.classList.add("bx-flip-"+n2);break;case"animation":e4&&r2.classList.remove("bx-"+e4),n2&&r2.classList.add("bx-"+n2)}},"value")},{key:"connectedCallback",value:__name(function(){h()&&p.ShadyCSS.styleElement(this)},"value")}]),e3}());e2.default=g,g.define()}])},"e"),module.exports=e()})})(boxicons);const name="gantt-chart",version="0.1.5",type="module",scripts={test:"vitest",dev:"vite",prebuild:"rm dist/ -rf",build:"tsc && vite build && touch ./dist/.nojekyll",preview:"vite preview",deploy:'cd dist/ && git init && git add -A && git commit -m "gh-pages" && git push https://github.com/kkn1125/gantt-chart.git master:gh-pages -f'},devDependencies={"@types/node":"^22.5.1",dotenv:"^16.3.1",jsdom:"^26.0.0",path:"^0.12.7",sass:"^1.77.8",terser:"^5.24.0",typescript:"^5.2.2",vite:"^5.4.14"},dependencies={boxicons:"^2.1.4","gantt-chart":"file:",vitest:"^3.0.5"},packageJson={name,private:!0,version,type,scripts,devDependencies,dependencies},WRAP_SHEETS=document.querySelector("#wrap-sheets"),SHEET_FILES=document.querySelector("#wrap-sheets-files");document.querySelector("#app");document.querySelector("#main");const createEl=__name(element=>document.createElement(element),"createEl"),MENU=document.querySelector("#menu"),HEADER=document.querySelector("#header"),PANEL=document.querySelector("#panel"),BOARD=document.querySelector("#board"),MESSAGE={NO_SELECTED_CELL:"선택한 셀이 없습니다!",CANT_CONCAT:"thead와 tbody는 함께 혼합 할 수 없습니다.",CANT_SPLIT:"thead와 tbody는 함께 분해 할 수 없습니다.",REMOVE_COLUMN_DENIED:"열은 최소 1개가 존재해야합니다.",REMOVE_ROW_DENIED:"행은 최소 1개가 존재해야합니다."},VALUE={DEFAULT_CELL_CONTENT:""},_Logger=class _Logger{constructor(context="system"){__publicField(this,"context");__publicField(this,"log");__publicField(this,"debug");__publicField(this,"error");__publicField(this,"process");__publicField(this,"check");this.setContext(context)}setContext(context){this.log=()=>{},this.debug=()=>{},this.error=()=>{},this.process=()=>{},this.check=()=>{}}};__name(_Logger,"Logger");let Logger=_Logger;const _BaseModule=class _BaseModule{constructor(){__publicField(this,"logger");__publicField(this,"dependencies");__publicField(this,"subColor","#ffffff");this.logger=new Logger(this.constructor.name),this.logger.process("initialize",this.constructor.name),Object.assign(this,{dependencies:{}})}inject(module){Object.assign(this.dependencies,{[module.constructor.name]:module})}bulkInjection(modules){this.logger.process("bulk injection modules",modules),modules.forEach(module=>{this.inject(module)})}createEl(element){return createEl(element)}};__name(_BaseModule,"BaseModule");let BaseModule=_BaseModule;const _EventManager=class _EventManager extends BaseModule{constructor(){super();__publicField(this,"editingEl",null);this.handleCellInput=this.handleCellInput.bind(this)}initialize(){window.addEventListener("keydown",this.handleKeydown.bind(this)),window.addEventListener("input",this.handleInput.bind(this)),window.addEventListener("change",this.handleChange.bind(this)),window.addEventListener("click",this.handleClick.bind(this)),window.addEventListener("mousemove",this.handleMouseMove.bind(this)),window.addEventListener("dblclick",this.handleDoubleClick.bind(this)),window.addEventListener("mousedown",this.handleSelectStart.bind(this)),window.addEventListener("mouseup",this.handleSelectEnd.bind(this)),window.addEventListener("contextmenu",this.handleContextMenu.bind(this))}initializeSelectedInTableCells(){this.logger.process("🛠️ check","initialize selected"),this.dependencies.TableManager.initSelected(),this.logger.process("check selected",this.dependencies.TableManager.selected)}removeContentEditable(){var _a;this.logger.debug("cancel"),document.querySelectorAll("[contenteditable]").forEach(cell=>{cell.removeAttribute("contenteditable")}),(_a=this.editingEl)==null||_a.removeEventListener("input",this.handleCellInput),this.editingEl=null}removeContentEditableAndSave(){this.removeContentEditable(),this.dependencies.TableManager.saveTable()}openPanel(){this.dependencies.PanelManager.openPanel()}closePanel(){this.dependencies.PanelManager.closePanel()}isOpenedPanel(){return this.dependencies.PanelManager.isOpened()}isOpenedSheetTool(){return this.dependencies.PanelManager.isOpenedSheetTool()}handleInput(e){const target=e.target;if(target&&target.classList.contains("total")){const hexColor=target.value,palette=this.dependencies.PanelManager.parseHexToRGB(hexColor);this.dependencies.PanelManager.previewColor=palette,this.dependencies.PanelManager.previewUpdate(),this.dependencies.TableManager.selected.forEach(cell=>{Object.assign(cell.style,{backgroundColor:this.dependencies.PanelManager.getBackgroundColor()})}),this.dependencies.TableManager.saveTable(),this.dependencies.TableManager.update()}}handleContextMenu(e){if(e.button===2){e.preventDefault(),e.stopPropagation();const target=e.target;target&&target.classList.contains("cell")&&(this.isOpenedPanel()?this.updatePanel():(this.updatePanel(),this.openPanel(),this.dependencies.Ui.isOpenSheetTool()&&this.dependencies.Ui.closeSheetTool())),target&&target.classList.contains("sheet")&&(this.dependencies.Ui.closeSheetTool(),this.dependencies.Ui.openSheetTool(target),this.isOpenedPanel()&&this.closePanel())}}handleSelectStart(e){if(e.button!==0)return;if(!e.shiftKey){const target2=e.target;target2&&!target2.closest("#panel")&&this.initializeSelectedInTableCells()}const target=e.target;if(target&&target.classList.contains("cell")){const cell=this.dependencies.TableManager.findCellByPos(+target.dataset.posX,+target.dataset.posY);cell&&(this.logger.check("check cell"),this.dependencies.TableManager.selectCell(cell),this.dependencies.Ui.startDrawDragRect(e))}}handleMouseMove(e){const target=e.target;if(this.dependencies.Ui.movingDrawDragRect(e),!target.closest("#menu-list")&&!target.closest("#sub-list")&&this.dependencies.Ui.currentTab!==target.dataset.tool&&(this.dependencies.MenuManager.close(),this.dependencies.Ui.closeTabMenu()),target.dataset.tool||target.closest("#menu-list")||target.closest("#sub-list")?(target.dataset.tool&&(this.dependencies.Ui.currentTab=target.dataset.tool),this.dependencies.Ui.dropdownHovered=!0):this.dependencies.Ui.dropdownOpened=!1,!document.querySelector("#menu-list")&&this.dependencies.Ui.dropdownHovered&&this.dependencies.Ui.dropdownOpened&&target.dataset.tool!==void 0){const menu=this.dependencies.MenuManager.findTab(target.dataset.tool);if(menu){const root=document.querySelector(`[data-tool="${menu.group}"]`);this.dependencies.Ui.openTabMenu(menu,root)}}}handleSelectEnd(e){if(e.button!==0)return;const target=e.target;if(target&&target.classList.contains("cell")){const cell=this.dependencies.TableManager.findCellByPos(+target.dataset.posX,+target.dataset.posY);cell&&this.dependencies.Ui.dragUiActivate&&(this.dependencies.TableManager.hasSelected(cell)&&this.logger.check("selected had cell",cell),this.dependencies.TableManager.selectCell(cell),this.dependencies.TableManager.highlightSelectedCells())}else target&&!target.closest("#panel")&&this.initializeSelectedInTableCells();this.isOpenedPanel()&&this.updatePanel(),this.dependencies.Ui.endDrawDragRect(e)}updatePanel(){this.dependencies.PanelManager.initializeCellBackgroudColorSet(),this.dependencies.PanelManager.previewUpdate(),this.dependencies.PanelManager.initializeCellBorders(),this.dependencies.PanelManager.initializeSizeOptions(),this.dependencies.PanelManager.update()}handleClick(e){const target=e.target;if(target.dataset.toolName){const tab=this.dependencies.MenuManager.findTabByName(target.dataset.toolName);this.logger.log(tab,target.dataset.toolName),tab==null||tab.feature()}if(this.dependencies.MenuManager.close(),this.dependencies.Ui.closeTabMenu(),this.dependencies.Ui.dropdownOpened=!1,target.classList.contains("exit")&&document.querySelectorAll(".about-command").forEach(el=>el==null?void 0:el.remove()),target.dataset.tool!==void 0){const menu=this.dependencies.MenuManager.findTab(target.dataset.tool);if(menu){const root=document.querySelector(`[data-tool="${menu.group}"]`);this.dependencies.Ui.openTabMenu(menu,root),this.dependencies.Ui.dropdownOpened=!0}}if(target&&target.classList.contains("sheet")){const id=+(target.dataset.sheetId||0);this.dependencies.TableManager.swapSheet(id)}if(target&&target.classList.contains("sheet-menu")){const id=+target.dataset.sheetId,feature=target.dataset.sheetFeat;this.dependencies.Ui.runSheetTool(feature,id),this.dependencies.Ui.closeSheetTool(),this.dependencies.TableManager.saveTable(),this.dependencies.StorageManager.loadStorage(),this.dependencies.TableManager.update(),this.dependencies.Ui.render()}if(this.dependencies.Ui.isOpenSheetTool()&&this.dependencies.Ui.closeSheetTool(),target&&target.classList.contains("cell")?this.editingEl&&this.editingEl!==target&&this.removeContentEditableAndSave():this.editingEl&&(this.removeContentEditableAndSave(),this.editingEl.removeEventListener("input",this.handleCellInput)),target&&!target.closest("#panel")&&this.isOpenedPanel()&&this.dependencies.TableManager.selected.length===0&&this.closePanel(),target&&target.closest("#panel")){if("dir"in target.dataset)switch(target.dataset.dir){case"all":this.dependencies.TableManager.concatAll();break;case"split":this.dependencies.TableManager.splitCell();break}else if("cellAdd"in target.dataset)switch(target.dataset.cellAdd){case"left":this.dependencies.TableManager.addColumnLeftSide();break;case"right":this.dependencies.TableManager.addColumnRightSide();break;case"top":this.dependencies.TableManager.addRowTop();break;case"bottom":this.dependencies.TableManager.addRowBottom();break}else if("cellRemove"in target.dataset)switch(target.dataset.cellRemove){case"row":this.dependencies.TableManager.removeRow();break;case"column":this.dependencies.TableManager.removeColumn();break}else if("cellFeature"in target.dataset)switch(target.dataset.cellFeature){case"remove-style":this.dependencies.TableManager.removeStyle();break;case"remove-content":this.dependencies.TableManager.removeContent();break}else if("borderCheck"in target.dataset){switch(target.dataset.borderCheck){case"top":{this.dependencies.TableManager.drawBorderTop();break}case"bottom":{this.dependencies.TableManager.drawBorderBottom();break}case"left":{this.dependencies.TableManager.drawBorderLeft();break}case"right":{this.dependencies.TableManager.drawBorderRight();break}case"all":{this.logger.log("all"),this.dependencies.TableManager.drawBorderAll();break}}this.updatePanel(),this.dependencies.TableManager.saveTable(),this.dependencies.TableManager.update()}}}makeEditable(target){var _a;target.contentEditable="true",target.focus(),window.getSelection().selectAllChildren(target),(_a=this.editingEl)==null||_a.addEventListener("input",this.handleCellInput)}handleDoubleClick(e){const target=e.target;target.classList.contains("cell")&&(this.editingEl=target,this.makeEditable(this.editingEl))}handleCellInput(){if(!this.editingEl)return;const id=+this.editingEl.dataset.id,type2=this.editingEl.dataset.type,cell=this.dependencies.TableManager.findCellById(id,type2);cell&&cell.setContent(this.editingEl.innerText)}handleKeydown(e){var _a,_b,_c,_d,_e,_f,_g,_h;const key=e.key.toLowerCase();if(this.editingEl){if(e.shiftKey&&key==="enter"&&this.removeContentEditableAndSave(),key==="escape"&&(this.removeContentEditable(),this.dependencies.TableManager.initSelected(),this.dependencies.TableManager.saveTable(),this.dependencies.TableManager.update()),key==="tab")if(e.preventDefault(),e.shiftKey){const tableLocate=(_c=(_b=(_a=this.editingEl)==null?void 0:_a.parentElement)==null?void 0:_b.parentElement)==null?void 0:_c.parentElement;if(!tableLocate)return;const dataId=(_d=this.editingEl)==null?void 0:_d.getAttribute("data-id");if(!dataId)return;const nextId=+dataId-1;let nextEditEl=tableLocate.querySelector(`[data-id="${nextId}"]`)??null;nextEditEl||(nextEditEl=[...tableLocate.querySelectorAll(":is(thead,tbody):last-child td:last-child")].pop()??null),this.removeContentEditable(),this.editingEl=nextEditEl??null,this.editingEl&&this.makeEditable(this.editingEl)}else{const tableLocate=(_g=(_f=(_e=this.editingEl)==null?void 0:_e.parentElement)==null?void 0:_f.parentElement)==null?void 0:_g.parentElement;if(!tableLocate)return;const dataId=(_h=this.editingEl)==null?void 0:_h.getAttribute("data-id");if(!dataId)return;const nextId=+dataId+1;let nextEditEl=tableLocate.querySelector(`[data-id="${nextId}"]`)??null;nextEditEl||(nextEditEl=tableLocate.querySelector('[data-id="0"]')),this.removeContentEditable(),this.editingEl=nextEditEl??null,this.editingEl&&this.makeEditable(this.editingEl)}}else{if(e.ctrlKey){if(key==="a"&&(this.dependencies.TableManager.selectAllCells(),this.dependencies.TableManager.highlightSelectedCells()),this.dependencies.TableManager.selected.length===0)return;if(key==="c"){const copyContents=this.dependencies.TableManager.selected.map(cell=>cell.content).filter(content=>content.trim()).join(`
`);if(navigator.clipboard.writeText(copyContents).then(()=>{this.logger.check("completed copied by cells contents.")}),e.shiftKey){e.preventDefault();const cell=this.dependencies.TableManager.selected[0];cell&&(this.dependencies.StorageManager.copyStyle=Object.assign(Object.create({}),cell.style))}}key==="v"&&(navigator.clipboard.readText().then(value=>{this.dependencies.TableManager.selected.forEach(cell=>{cell.content=value}),this.logger.check("paste user's copied text: "+value),this.dependencies.TableManager.saveTable(),this.dependencies.TableManager.update()}),e.shiftKey&&this.dependencies.TableManager.selected.forEach(cell=>{cell.style=Object.assign(Object.create({}),this.dependencies.StorageManager.copyStyle)}))}key==="escape"&&(document.querySelectorAll(".about-command").forEach(el=>el==null?void 0:el.remove()),this.isOpenedPanel()&&this.closePanel(),this.isOpenedSheetTool()&&this.dependencies.Ui.closeSheetTool(),this.isOpenedSheetRenameWindow()&&this.dependencies.Ui.closeSubmitRename(),this.dependencies.TableManager.initSelected(),this.dependencies.TableManager.saveTable(),this.dependencies.TableManager.update()),key==="backspace"&&(this.dependencies.TableManager.selected.forEach(cell=>{cell.content=""}),this.dependencies.TableManager.saveTable(),this.dependencies.TableManager.update())}}isOpenedSheetRenameWindow(){return!!window.renameForm}handleChange(e){const target=e.target;if(target&&target.classList.contains("rgba")){const rgbaName=target.name;this.dependencies.PanelManager.previewColor[rgbaName]=+target.value,this.dependencies.PanelManager.previewUpdate(),this.dependencies.TableManager.selected.forEach(cell=>{Object.assign(cell.style,{backgroundColor:this.dependencies.PanelManager.getBackgroundColor()})}),this.dependencies.TableManager.saveTable(),this.dependencies.TableManager.update()}target&&target.name==="width"&&(this.dependencies.TableManager.selected.flatMap(cell=>this.dependencies.TableManager.getColumnBy(cell.x)).forEach(cell=>{cell.style.width=target.value==="-1"?"auto":target.value+"px"}),this.dependencies.TableManager.saveTable(),this.dependencies.TableManager.update()),target&&target.name==="height"&&(this.dependencies.TableManager.selected.flatMap(cell=>cell.type==="th"?this.dependencies.TableManager.getHeadRowBy(cell.y):this.dependencies.TableManager.getBodyRowBy(cell.y)).forEach(cell=>{cell.style.height=target.value==="-1"?"auto":target.value+"px"}),this.dependencies.TableManager.saveTable(),this.dependencies.TableManager.update())}};__name(_EventManager,"EventManager");let EventManager=_EventManager;const _DropdownMenuItem=class _DropdownMenuItem{constructor(group,name2,feature){__publicField(this,"originGroup");__publicField(this,"originName");__publicField(this,"parent",null);__publicField(this,"group");__publicField(this,"name");__publicField(this,"feature",__name(()=>{},"feature"));__publicField(this,"menuItems",[]);__publicField(this,"isOpen",!1);this.group=group,this.name=name2,feature&&(this.feature=feature.bind(feature,this)),this.originGroup=group,this.originName=name2}setName(name2){this.name=name2}initName(){this.name=this.originName}initGroup(){this.group=this.originGroup}addSubMenuItem(dropdownMenuItem){dropdownMenuItem.parent=this,this.menuItems.push(dropdownMenuItem)}addMenuItem(dropdownMenuItem){dropdownMenuItem.parent=this,dropdownMenuItem.group=this.group,this.menuItems.push(dropdownMenuItem)}open(){this.isOpen=!0,this.menuItems.forEach(menuItem=>menuItem.open())}close(){this.isOpen=!1,this.menuItems.forEach(menuItem=>menuItem.close())}findTab(tabName){return this.menuItems.find(menu=>menu.group===tabName?(menu.open(),menu):menu.findTab(tabName))}findTabByName(name2){let temp=null;if(this.name===name2?temp=this:this.menuItems.forEach(menu=>{const result=menu.findTabByName(name2);result&&(temp=result)}),temp)return temp}};__name(_DropdownMenuItem,"DropdownMenuItem");let DropdownMenuItem=_DropdownMenuItem;const _MenuManager=class _MenuManager extends BaseModule{constructor(){super();__publicField(this,"menulist",[])}initialize(){const fileTab=new DropdownMenuItem("file","파일"),fileNewSheet=new DropdownMenuItem("file","New Sheet",this.dependencies.ToolManager.fileNewSheet.bind(this)),fileLocalSave=new DropdownMenuItem("file","Local Save",this.dependencies.ToolManager.fileLocalSave.bind(this)),fileSaveAs=new DropdownMenuItem("saveas","Save as ..."),fileClose=new DropdownMenuItem("file","Close",this.dependencies.ToolManager.fileClose.bind(this)),fileSaveAsHTML=new DropdownMenuItem("file","Save as HTML",this.dependencies.ToolManager.fileSaveAsHTML.bind(this)),fileSaveAsBackup=new DropdownMenuItem("file","Save as Backup",this.dependencies.ToolManager.fileSaveAsBackup.bind(this));fileSaveAs.addMenuItem(fileSaveAsHTML),fileSaveAs.addMenuItem(fileSaveAsBackup),fileTab.addMenuItem(fileNewSheet),fileTab.addMenuItem(fileLocalSave),fileTab.addSubMenuItem(fileSaveAs),fileTab.addMenuItem(fileClose);const toolTab=new DropdownMenuItem("tool","도구"),toolFullScreen=new DropdownMenuItem("screen","Full Screen",this.dependencies.ToolManager.toolFullScreen.bind(this)),toolAddCell=new DropdownMenuItem("add tool","add rows, columns"),toolAddColumnBefore=new DropdownMenuItem("tool","Add column: Before",this.dependencies.ToolManager.toolAddColumnBefore.bind(this)),toolAddColumnAfter=new DropdownMenuItem("tool","Add column: After",this.dependencies.ToolManager.toolAddColumnAfter.bind(this)),toolAddRowHeadTop=new DropdownMenuItem("tool","Add row: Head top",this.dependencies.ToolManager.toolAddRowHeadTop.bind(this)),toolAddRowHeadBottom=new DropdownMenuItem("tool","Add row: Head bottom",this.dependencies.ToolManager.toolAddRowHeadBottom.bind(this)),toolAddRowBodyTop=new DropdownMenuItem("tool","Add row: Body top",this.dependencies.ToolManager.toolAddRowBodyTop.bind(this)),toolAddRowBodyBottom=new DropdownMenuItem("tool","Add row: Body bottom",this.dependencies.ToolManager.toolAddRowBodyBottom.bind(this)),toolTableFix=new DropdownMenuItem("tool",`Table:${this.dependencies.StorageManager.storages.options.tableLayout==="fixed"?"auto":"fixed"}`,this.dependencies.ToolManager.toolTableFixed.bind(this));toolAddCell.addMenuItem(toolAddColumnBefore),toolAddCell.addMenuItem(toolAddColumnAfter),toolAddCell.addMenuItem(toolAddRowHeadTop),toolAddCell.addMenuItem(toolAddRowHeadBottom),toolAddCell.addMenuItem(toolAddRowBodyTop),toolAddCell.addMenuItem(toolAddRowBodyBottom),toolTab.addMenuItem(toolFullScreen),toolTab.addMenuItem(toolTableFix),toolTab.addSubMenuItem(toolAddCell);const aboutTab=new DropdownMenuItem("about","도움말"),aboutHelper=new DropdownMenuItem("about","사용방법",this.dependencies.ToolManager.aboutHelper.bind(this));aboutTab.addMenuItem(aboutHelper),this.addMenu(fileTab),this.addMenu(toolTab),this.addMenu(aboutTab)}addMenu(menuItem){this.menulist.push(menuItem)}drawGnb(){MENU.innerHTML=this.menulist.map(menu=>`<div class="tab small fw-bold capitalize" data-tool="${menu.group}">${menu.name}</div>`).join("")}findTabByName(name2){for(const menu of this.menulist){const result=menu.findTabByName(name2);if(result)return result}}render(){this.drawGnb()}findTab(tabName){const menu=this.menulist.find(menu2=>menu2.findTab(tabName));if(menu)return menu}open(tabName){return this.findTab(tabName)}close(){this.menulist.forEach(menu=>menu.close())}};__name(_MenuManager,"MenuManager"),__publicField(_MenuManager,"Item",DropdownMenuItem);let MenuManager=_MenuManager;const _Cell=class _Cell{constructor(xOrItem,y,type2,content){__publicField(this,"logger");__publicField(this,"id");__publicField(this,"x");__publicField(this,"y");__publicField(this,"posX");__publicField(this,"posY");__publicField(this,"content","🛠️ 내용을 입력해주세요");__publicField(this,"type","td");__publicField(this,"style",{});__publicField(this,"option",{});__publicField(this,"selected",!1);if(this.logger=new Logger(this.constructor.name),xOrItem instanceof Object){const{id,x,y:y2,content:content2,type:type22,style,option,posX,posY,selected}=xOrItem;this.id=id,this.x=x,this.y=y2,this.type=type22,this.content=content2||VALUE.DEFAULT_CELL_CONTENT,this.style=style,this.option=option,this.posX=posX,this.posY=posY,this.selected=selected}else _Cell.id+=1,this.id=_Cell.id,this.x=xOrItem,this.y=y,this.type=type2||"td",this.posX=0,this.posY=0,this.content=content||VALUE.DEFAULT_CELL_CONTENT}load({id,x,y,content,type:type2,posX,posY,selected,style,option}){this.id=id,this.x=x,this.y=y,this.posX=posX,this.posY=posY,this.content=content,this.type=type2,this.selected=selected,this.style=style,this.option=option}setContent(content){this.content=content}render(){const el=createEl(this.type);return el.style.cssText="padding: 0.5rem 1rem;",el.dataset.id=""+this.id,el.dataset.x=""+this.x,el.dataset.y=""+this.y,el.dataset.type=this.type,Object.assign(el,this.option),Object.assign(el.style,this.style),el.innerText=this.content,el.classList.add("cell"),this.selected&&el.setAttribute("selected",""),el}hasStyle(type2){return type2 in this.style&&this.style[type2]!==""}hasBorder(direction){const dir=direction[0].toUpperCase()+direction.slice(1);return this.hasStyle(`border${dir}`)||this.hasStyle(`border${dir}Width`)||this.hasStyle(`border${dir}Style`)||this.hasStyle(`border${dir}Color`)}removeStyle(style){delete this.style[style]}};__name(_Cell,"Cell"),__publicField(_Cell,"id",-1);let Cell=_Cell;const _Sheet=class _Sheet{constructor(data){__publicField(this,"logger");__publicField(this,"id");__publicField(this,"name","sheet");__publicField(this,"content",{head:[],body:[]});if(this.logger=new Logger(this.constructor.name),data){const{id,name:name2,content}=data;this.id=id,this.name=name2,this.content.head=content.head.map(row=>row.map(head=>new Cell(head))),this.content.body=content.body.map(row=>row.map(body=>new Cell(body)))}else _Sheet.id+=1,this.id=_Sheet.id,this.id>0&&(this.name=`${this.name} (${this.id})`),this.content.head=[[new Cell(0,0,"th")]],this.content.body=[[new Cell(0,0,"td")]],this.logger.setContext(this.constructor.name+"|"+this.id)}rename(name2){this.name=name2}save(head,body){this.logger.debug("debug",this,this.content),this.content.head=head,this.content.body=body}};__name(_Sheet,"Sheet"),__publicField(_Sheet,"id",-1);let Sheet=_Sheet;const _StorageManager=class _StorageManager extends BaseModule{constructor(){super();__publicField(this,"STORAGE","gantt-store");__publicField(this,"sheetNumber",0);__publicField(this,"copyStyle",{});__publicField(this,"storages",{sheets:[],options:{}})}set addOption(options){Object.assign(this.storages.options,options)}getBigId(){return this.storages.sheets.reduce((acc,cur)=>(acc<cur.id&&(acc=cur.id),acc),0)||0}setCurrentSheetNumber(id){this.sheetNumber=id}initialize(){this.logger.process("initialize storage"),this.isEmpty()&&(this.addSheet(new Sheet({id:1,name:"sheet01",content:{head:[[new Cell(0,0,"th","test")]],body:[[new Cell(0,0,"td","test")]]}})),this.saveStorage(),this.logger.process("setup empty storage as object")),this.loadStorage(),Sheet.id=this.getBigId(),this.logger.process("✨ loaded storage")}isEmpty(){const item=localStorage.getItem(this.STORAGE);return item===""||item===void 0||item===null}getStorage(){return this.logger.debug("get storage"),JSON.parse(localStorage.getItem(this.STORAGE)||"{}")}initSheetNumber(){this.storages.sheets.every(sheet=>sheet.id!==this.sheetNumber)&&(this.sheetNumber=this.storages.sheets[0].id)}saveStorage(sheets=this.storages.sheets){this.logger.debug("save storage",sheets),localStorage.setItem(this.STORAGE,JSON.stringify(this.storages))}loadStorage(){return this.logger.debug("load storage",this.storages),this.storages=this.getStorage(),this.storages.sheets=this.storages.sheets.map(sheet=>new Sheet(sheet)),this.initSheetNumber(),this.storages}moveSheet(sheetId,move){const index=this.findSheetIndex(sheetId),moveIndex=index+move,[sheet]=this.storages.sheets.splice(index,1);this.logger.log("move sheet",sheet),this.storages.sheets.splice(moveIndex,0,sheet),this.saveStorage()}addSheet(data){data.id?this.storages.sheets.push(new Sheet(data)):(data.id=++Sheet.id,this.storages.sheets.push(new Sheet(data))),this.saveStorage()}findSheet(id){return this.logger.debug("find sheet",id),this.storages.sheets.find(sheet=>sheet.id===id)}findSheetIndex(id){return this.logger.debug("find index sheet",id),this.storages.sheets.findIndex(sheet=>sheet.id===id)}deleteSheet(id){if(this.storages.sheets.length>1){const index=this.findSheetIndex(id),nextSheet=this.storages.sheets[index+1]??this.storages.sheets[index-1],deletedSheet=this.storages.sheets.splice(index,1);return this.sheetNumber=nextSheet.id,deletedSheet}}update(sheet){const index=this.findSheetIndex(sheet.id);this.storages.sheets.splice(index,1,sheet)}renameSheet(id,newName){var _a;(_a=this.findSheet(id))==null||_a.rename(newName)}};__name(_StorageManager,"StorageManager");let StorageManager=_StorageManager;const getNumberBySheetName=__name(sheetName=>Number(sheetName.replace("sheet","")),"getNumberBySheetName"),findEmptyNumbers=__name(sheetNames=>{let index=0,compareBase=0;const emptyNumbers=[];for(;sheetNames.length-1!==index;){const compareSheetName=sheetNames[compareBase];getNumberBySheetName(compareSheetName)!==index+1?emptyNumbers.push(index+1):compareBase++,index++}return emptyNumbers},"findEmptyNumbers"),_ToolManager=class _ToolManager extends BaseModule{constructor(){super()}createNewSheet(){const sheetNames=this.dependencies.StorageManager.storages.sheets.reduce((acc,cur)=>(cur.name.match(/^sheet/)&&!acc.includes(cur.name)&&acc.push(cur.name),acc),[]).toSorted((a,b)=>a>b?1:-1),nextSheetName=`sheet${(findEmptyNumbers(sheetNames).shift()||getNumberBySheetName(sheetNames[sheetNames.length-1])+1).toString().padStart(2,"0")}`;this.dependencies.StorageManager.addSheet(new Sheet({id:++Sheet.id,name:nextSheetName,content:{head:[[new Cell(0,0,"th","test")]],body:[[new Cell(0,0,"td","test")]]}}))}save(){this.logger.debug("save"),this.dependencies.TableManager.saveTable()}async requestFullScreen(){try{await document.body.requestFullscreen({navigationUI:"auto"})}catch(err){alert(`Error attempting to enable fullscreen mode: ${err.message} (${err.name})`)}}async exitFullScreen(){try{await document.exitFullscreen()}catch{}}fileNewSheet(_self){this.logger.log("create new sheet"),this.dependencies.ToolManager.createNewSheet(),this.dependencies.Ui.render()}fileLocalSave(_self){this.logger.log("save"),this.dependencies.TableManager.saveTable()}fileSaveAsHTML(_self){this.logger.log("save as new filename"),this.dependencies.TableManager.exportHTML()}fileSaveAsBackup(_self){this.logger.log("save as backup")}fileClose(_self){this.logger.log("close gantt chart")}toolFullScreen(self){self.name==="Full Screen"?(this.dependencies.ToolManager.requestFullScreen(),self.setName("Exit Screen")):(this.dependencies.ToolManager.exitFullScreen(),self.setName("Full Screen"))}toolAddColumnBefore(_self){this.logger.log("add before column"),this.dependencies.TableManager.addBeforeColumn()}toolAddColumnAfter(_self){this.logger.log("add before column"),this.dependencies.TableManager.addAfterColumn()}toolAddRowHeadTop(_self){this.logger.log("add after column"),this.dependencies.TableManager.addRowHeadTop()}toolAddRowHeadBottom(_self){this.logger.log("add after column"),this.dependencies.TableManager.addRowHeadBottom()}toolAddRowBodyTop(_self){this.logger.log("add after column"),this.dependencies.TableManager.addRowBodyTop()}toolAddRowBodyBottom(_self){this.logger.log("add after column"),this.dependencies.TableManager.addRowBodyBottom()}toolTableFixed(self){self.name==="Table:fixed"?(this.dependencies.TableManager.tableLayoutFixed(),this.logger.log("table size fixed"),self.setName("Table:auto")):(this.dependencies.TableManager.tableLayoutAuto(),self.setName("Table:fixed"))}aboutHelper(_self){this.logger.log("도움말 열기"),this.dependencies.Ui.popupAbout()}sheetToolRemove(sheetId){this.dependencies.StorageManager.deleteSheet(sheetId)}sheetToolRename(sheetId,rename){this.dependencies.StorageManager.renameSheet(sheetId,rename)}sheetToolMoveLeft(sheetId){this.dependencies.StorageManager.moveSheet(sheetId,-1)}sheetToolMoveRight(sheetId){this.dependencies.StorageManager.moveSheet(sheetId,1)}};__name(_ToolManager,"ToolManager");let ToolManager=_ToolManager;const _Ui=class _Ui extends BaseModule{constructor(){super();__publicField(this,"currentTab","");__publicField(this,"dropdowns");__publicField(this,"currentSheet",0);__publicField(this,"openedTool","");__publicField(this,"dropdownHovered",!1);__publicField(this,"dropdownOpened",!1);__publicField(this,"dragUiActivate",!1);__publicField(this,"dragAreaUi",this.createEl("div"));this.dragAreaUi.setAttribute("un-touchable",""),BOARD.append(this.dragAreaUi)}isChangedBeforeTool(toolName){return this.openedTool!==toolName}isDropdownOpened(){return!!document.querySelector("#menu-list")}openTabMenu(menu,target,isSub=!1){const rect=target.getBoundingClientRect(),id=`${isSub?"sub":"menu"}-list`,menuListEl=document.querySelector(id),menuList=document.createElement("div");let menuEl;menuListEl?menuEl=menuListEl:(menuEl=menuList,menuEl.id=`${isSub?"sub":"menu"}-list`),isSub?(menuEl.style.top=rect.top+"px",menuEl.style.left=rect.right+"px"):(menuEl.style.top=rect.bottom+"px",menuEl.style.left=rect.left+"px"),menuEl.innerHTML=menu.menuItems.map(menuItem=>`<div class="menu-item"${menuItem.menuItems.length>0?` data-tool="${menuItem.group}"`:""}${menuItem.feature?` data-tool-name="${menuItem.name}"`:""}>${menuItem.name}${menuItem.menuItems.length>0?">>":""}</div>`).join(""),document.body.insertAdjacentElement("beforeend",menuEl),menu.menuItems.length>0&&menu.menuItems.forEach(sub=>{if(menu.group!==sub.group&&sub.isOpen){const root=menuEl.querySelector(`[data-tool="${sub.group}"]`);this.openTabMenu(sub,root,!0)}})}setupDropdownMenus(){this.dropdowns=this.dependencies.MenuManager}drawSheets(){const storageManager=this.dependencies.StorageManager;SHEET_FILES.innerHTML=storageManager.storages.sheets.map(sheet=>`<div class="sheet" data-sheet-id="${sheet.id}" data-sheet-name="${sheet.name}"${sheet.id===storageManager.sheetNumber?"current-sheet":""}>${sheet.id}. ${sheet.name}</div>`).join("")}initialize(){this.setupDropdownMenus(),this.logger.log(this),this.logger.log(this.dependencies.MenuManager),this.logger.log(this.dropdowns),this.dropdowns.render(),this.drawVersionTag(),this.render()}startDrawDragRect(e){const startPointX=e.clientX,startPointY=e.clientY;this.dragUiActivate=!0,this.dragAreaUi.custom={x:startPointX,y:startPointY},this.dragAreaUi.style.position="fixed",this.dragAreaUi.style.top=startPointY+"px",this.dragAreaUi.style.left=startPointX+"px",this.dragAreaUi.style.transformOrigin="top left",this.logger.debug(`Start DragRect: ${startPointX} ${startPointY}`)}movingDrawDragRect(e){if(!this.dragUiActivate)return;const leftColor="#b8e24f",rightColor="#598de8",leftBorder=__name((type2="solid")=>`1px ${type2} ${leftColor}`,"leftBorder"),rightBorder=__name((type2="solid")=>`1px ${type2} ${rightColor}`,"rightBorder"),movePointX=e.clientX-this.dragAreaUi.custom.x,movePointY=e.clientY-this.dragAreaUi.custom.y;let valueX=movePointX,valueY=movePointY;movePointX<0&&movePointY>=0?(this.dragAreaUi.style.transform="scale(-1, 1)",this.dragAreaUi.style.backgroundColor=leftColor+56,this.dragAreaUi.style.border=leftBorder(),this.dragAreaUi.style.backgroundImage="",valueX*=-1,valueY*=1):movePointX>=0&&movePointY>=0?(this.dragAreaUi.style.transform="scale(1, 1)",this.dragAreaUi.style.backgroundColor=rightColor+56,this.dragAreaUi.style.border=rightBorder(),this.dragAreaUi.style.backgroundImage="",valueX*=1,valueY*=1):movePointX>=0&&movePointY<0?(this.dragAreaUi.style.transform="scale(1, -1)",this.dragAreaUi.style.backgroundColor=rightColor+56,this.dragAreaUi.style.border="",this.dragAreaUi.style.backgroundImage=`url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' stroke='%23598DE8FF' stroke-width='4' stroke-dasharray='6%2c 14' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e")`,valueX*=1,valueY*=-1):movePointX<0&&movePointY<0&&(this.dragAreaUi.style.transform="scale(-1, -1)",this.dragAreaUi.style.backgroundColor=leftColor+56,this.dragAreaUi.style.border="",this.dragAreaUi.style.backgroundImage=`url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' stroke='%23B8E24FFF' stroke-width='4' stroke-dasharray='6%2c 14' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e")`,valueX*=-1,valueY*=-1),this.dragAreaUi.style.width=valueX+"px",this.dragAreaUi.style.height=valueY+"px"}endDrawDragRect(e){this.dragAreaUi.style.position="",this.dragAreaUi.style.top="",this.dragAreaUi.style.left="",this.dragAreaUi.style.backgroundColor="",this.dragAreaUi.style.width="",this.dragAreaUi.style.height="",this.dragAreaUi.style.transformOrigin="",this.dragAreaUi.style.transform="",this.dragAreaUi.style.border="",this.dragAreaUi.style.backgroundImage="",this.dragUiActivate=!1;const endPointX=e.clientX,endPointY=e.clientY;this.logger.debug(`End DragRect: ${endPointX} ${endPointY}`)}openPanel(width){PANEL.classList.add("open");const isStringDigit=typeof width=="string"&&width.match(/^\d+$/),isNumber=!isNaN(+width);isStringDigit||isNumber?PANEL.style.width=width+"px":PANEL.style.width=width}closePanel(){PANEL.classList.remove("open"),PANEL.style.width=""}openSheetTool(target){const sheetTool=this.createEl("div");sheetTool.id="sheet-tool",sheetTool.dataset.sheetId=""+target.dataset.sheetId,sheetTool.innerHTML=`
      <div class="sheet-menu-list">
        <div class="sheet-menu" data-sheet-id="${target.dataset.sheetId}" data-sheet-feat="rename">rename</div>
        <div class="sheet-menu" data-sheet-id="${target.dataset.sheetId}" data-sheet-feat="remove">remove</div>
        <div class="sheet-menu" data-sheet-id="${target.dataset.sheetId}" data-sheet-feat="move-left">move left</div>
        <div class="sheet-menu" data-sheet-id="${target.dataset.sheetId}" data-sheet-feat="move-right">move right</div>
      </div>
    `;const{left}=target.getBoundingClientRect();sheetTool.style.bottom=innerHeight-BOARD.clientHeight-44+38.67+"px",sheetTool.style.left=left+"px",BOARD.append(sheetTool)}closeSheetTool(){document.querySelectorAll("#sheet-tool").forEach(el=>{el.remove()})}isOpenSheetTool(){return document.querySelectorAll("#sheet-tool").length>0}popupModal(message){return new Promise(resolve=>{const modal=document.createElement("div");modal.id="modal",modal.style.cssText=`
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        box-shadow: 0 0 1rem 0 #56565656;
      `;const title=document.createElement("div");title.innerText="안내",title.style.fontSize="1.2rem",title.style.fontWeight="700";const content=document.createElement("div");content.innerText=message;const confirmButton=document.createElement("button"),cancelButton=document.createElement("button");confirmButton.classList.add("sheet-menu"),cancelButton.classList.add("sheet-menu"),confirmButton.innerText="확인",cancelButton.innerText="취소";const buttonGroup=document.createElement("div");buttonGroup.style.cssText=`
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 1rem;
      `,buttonGroup.append(confirmButton,cancelButton),modal.append(content,buttonGroup),confirmButton.addEventListener("click",()=>{modal.remove(),resolve(!0)},{once:!0}),cancelButton.addEventListener("click",()=>{modal.remove(),resolve(!1)},{once:!0}),document.body.append(modal)})}async runSheetTool(feature,sheetId){feature==="remove"?await this.popupModal("삭제하시면 복구 불가합니다. 진행하시겠습니까?")&&this.dependencies.ToolManager.sheetToolRemove(sheetId):feature==="rename"?this.popupRename(rename=>{this.dependencies.ToolManager.sheetToolRename(sheetId,rename),this.dependencies.TableManager.saveTable(),this.dependencies.StorageManager.loadStorage(),this.dependencies.TableManager.update(),this.render()}):feature==="move-left"?this.dependencies.ToolManager.sheetToolMoveLeft(sheetId):feature==="move-right"&&this.dependencies.ToolManager.sheetToolMoveRight(sheetId)}popupRename(cb){var _a;const renameWindow=document.createElement("form");renameWindow.name="renameForm",renameWindow.addEventListener("submit",e=>{e.preventDefault(),window.renameForm.dataset.state!=="close"&&cb(window.renameForm.rename.value),window.renameForm.remove()},{once:!0}),renameWindow.innerHTML=`
      <input name="rename" type="text" />
      <button type="submit">change</button>
    `,document.body.append(renameWindow),(_a=renameWindow.querySelector("input"))==null||_a.focus()}closeSubmitRename(){window.renameForm.dataset.state="close",window.renameForm.dispatchEvent(new SubmitEvent("submit"))}render(){this.dependencies.TableManager.update(),this.drawSheets()}closeTabMenu(){document.querySelectorAll("#sub-list").forEach(item=>item.remove()),document.querySelectorAll("#menu-list").forEach(item=>item.remove())}drawVersionTag(){const versionTag=document.createElement("div");versionTag.id="version-tag",versionTag.title="v"+packageJson.version,versionTag.innerText="v"+packageJson.version,HEADER.append(versionTag)}popupAbout(){const about=document.createElement("div");about.innerHTML=`
      <div class="about-command">
        <div class="about-header">
          <div>
            도움말
          </div>
          <button class="exit">exit</button>
        </div>  
        <div class="about-body">
          <div>
            Ctrl + a : 전체 선택
          </div>
          <div>
            Ctrl + c : (셀 선택한 경우에만) 내용 전체 복사 (각 셀은 줄바꿈으로 복사됩니다.)
          </div>
          <div>
            Ctrl + Shift + c : (셀 선택한 경우에만) 내용 전체 복사 및 스타일 복사 (처음 선택된 셀의 스타일에 영향을 받습니다.)
          </div>
          <div>
            Ctrl + v : (셀 선택한 경우에만) 내용 붙여넣기
          </div>
          <div>
            Ctrl + Shift + v : (셀 선택한 경우에만) 내용 붙여넣기 및 스타일 붙여넣기
          </div>
          <div>
            BackSpace : (셀 선택한 경우에만) 내용 전체 지우기
          </div>
          <div>
            셀 더블클릭 : 내용 편집 모드
          </div>
          <div>
            탭 키 : 내용 편집 모드에서 탭 키를 누르면 다음 셀로 이동합니다. 우측 마지막 셀에서 탭 키를 누르면 다음 줄의 첫 셀로 이동하며, 최하단 마지막 셀에서는 최상단의 첫번째 셀로 이동합니다.
          </div>
          <div>
            Shift + 탭 키 : 내용 편집 모드에서 탭 키를 누르면 이전 셀로 이동합니다. 좌측 첫 셀에서 탭 키를 누르면 이전 줄의 마지막 셀로 이동하며, 최상단 첫번째 셀에서는 최하단의 마지막 셀로 이동합니다.
          </div>
          <div>
            셀 드래그 : 셀 범위 선택
          </div>
          <div>
            셀 클릭 : 단일 셀 선택
          </div>
          <div>
            우클릭 : 도구 패널 열기 (패널 옵션 값은 선택된 셀이 있어야 적용됩니다.)
          </div>
        </div>
      </div>
    `,document.body.append(about)}};__name(_Ui,"Ui");let Ui=_Ui;const _TableManager=class _TableManager extends BaseModule{constructor(){super();__publicField(this,"copyCell",null);__publicField(this,"selected",[]);__publicField(this,"options",{tableLayout:"auto",borderCollapse:"collapse"});__publicField(this,"table");__publicField(this,"thead");__publicField(this,"tbody");__publicField(this,"head",[]);__publicField(this,"body",[])}getCells(){return[].concat(...this.head,...this.body)}setupTable(){this.table=this.createEl("table"),this.thead=this.createEl("thead"),this.tbody=this.createEl("tbody"),this.table.append(this.thead,this.tbody),Object.entries(this.options).forEach(keyValue=>{const[k,v]=keyValue;k in this.table.style&&Object.assign(this.table.style,{[k]:v})}),WRAP_SHEETS.innerHTML="",WRAP_SHEETS.append(this.table),this.loadTable(),this.uploadSelected(),this.setupHeads(),this.setupBodies()}selectAllCells(){this.selected=[],this.head.flat(1).concat(this.body.flat(1)).forEach(cell=>{this.selectCell(cell)})}selectCell(cell){this.hasSelected(cell)||(cell.selected=!0,this.selected.push(cell))}swapSheet(sheetId){this.dependencies.StorageManager.setCurrentSheetNumber(sheetId),this.dependencies.Ui.render()}update(){Object.keys(this.dependencies.StorageManager.storages.options).length===0&&(this.dependencies.StorageManager.storages.options=this.options),this.setupTable(),this.saveTable()}hasSelected(cell){return this.selected.includes(cell)}initSelected(){document.querySelectorAll("[selected]").forEach(cell=>{cell.removeAttribute("selected");const{posX,posY}=cell.dataset;if(posX&&posY){const cell2=this.findCellByPos(+posX,+posY);cell2&&(cell2.selected=!1)}}),this.selected=[]}setupHeads(){for(let y=0;y<this.head.length;y++){const tr=this.createEl("tr");tr.dataset.row=""+y;for(let x=0;x<this.head[y].length;x++){const th=this.head[y][x].render();th.dataset.posX=""+x,th.dataset.posY=""+y,tr.append(th)}this.thead.append(tr)}}setupBodies(){for(let y=0;y<this.body.length;y++){const tr=this.createEl("tr");tr.dataset.row=""+y;for(let x=0;x<this.body[y].length;x++){const td=this.body[y][x].render();td.dataset.posX=""+x,td.dataset.posY=""+(this.head.length+y),tr.append(td)}this.tbody.append(tr)}}highlightSelectedCells(){var _a;const first=this.selected.at(0),last=this.selected.at(-1);if(first&&last)if(first===last)first.selected=!0,last.selected=!0,(_a=document.querySelector(`.cell[data-pos-x="${first.posX}"][data-pos-y="${first.posY}"]`))==null||_a.setAttribute("selected","");else{const minX=Math.min(first.posX,last.posX),maxX=Math.max(first.posX,last.posX),minY=Math.min(first.posY,last.posY),maxY=Math.max(first.posY,last.posY);[].concat(...this.head).concat(...this.body).forEach(cell=>{var _a2;minY<=cell.posY&&cell.posY<=maxY&&minX<=cell.posX&&cell.posX<=maxX&&(this.hasSelected(cell)||this.selectCell(cell),(_a2=document.querySelector(`.cell[data-pos-x="${cell.posX}"][data-pos-y="${cell.posY}"]`))==null||_a2.setAttribute("selected",""))})}}saveTable(){this.sortingPosition(),this.dependencies.StorageManager.saveStorage()}loadTable(){this.head=[],this.body=[];const storageManager=this.dependencies.StorageManager,sheet=storageManager.findSheet(storageManager.sheetNumber);sheet&&(this.head=sheet.content.head,this.body=sheet.content.body),this.sortingPosition()}uploadSelected(){this.selected=[],[].concat(...this.head,...this.body).forEach(cell=>{cell.selected&&this.selected.push(cell)})}initialize(){Object.keys(this.dependencies.StorageManager.storages.options).length>0&&(this.options=this.dependencies.StorageManager.storages.options),this.setupTable(),this.saveTable(),this.initSelected()}findCellById(id,type2){return type2==="th"?this.head.flat(1).find(cell=>cell.id===id):type2==="td"?this.body.flat(1).find(cell=>cell.id===id):void 0}findCellByPos(posX,posY){return[].concat(...this.head,...this.body).find(cell=>cell.posX===posX&&cell.posY===posY)}sortingPosition(){this.head.forEach((row,y)=>{row.forEach((cell,x)=>{cell.id=x+row.length*y,cell.x=x,cell.y=y,cell.posX=x,cell.posY=y})}),this.body.forEach((row,y)=>{row.forEach((cell,x)=>{cell.id=x+y*row.length+this.head.length*this.head[0].length,cell.x=x,cell.y=y,cell.posX=x,cell.posY=this.head.length+y})})}getColumnBy(xIndex){const temp=[];return this.head.forEach(row=>{temp.push(row[xIndex])}),this.body.forEach(row=>{temp.push(row[xIndex])}),temp}getHeadRowBy(yIndex){const temp=[];return temp.push(...this.head[yIndex]),temp}getBodyRowBy(yIndex){const temp=[];return temp.push(...this.body[yIndex]),temp}addColumnLeftSide(){const lastOne=this.selected[this.selected.length-1];if(!lastOne){this.logger.error("not selected cell"),alert(MESSAGE.NO_SELECTED_CELL);return}const cellPosX=lastOne.x,leftSideIndex=cellPosX-1>0?cellPosX-1:0;this.addColumn(leftSideIndex)}addColumnRightSide(){const lastOne=this.selected[this.selected.length-1];if(!lastOne){this.logger.error("not selected cell"),alert(MESSAGE.NO_SELECTED_CELL);return}const RightSideIndex=lastOne.x+1;this.addColumn(RightSideIndex)}addColumn(index){this.head.forEach((head,y)=>{head.splice(index,0,new Cell(index,y,"th"))}),this.body.forEach((body,y)=>{body.splice(index,0,new Cell(index,y,"td"))}),this.sortingPosition(),this.saveTable(),this.update()}addBeforeColumn(){this.head.forEach((head,y)=>{head.unshift(new Cell(0,y,"th"))}),this.body.forEach((body,y)=>{body.unshift(new Cell(0,y,"td"))}),this.sortingPosition(),this.saveTable(),this.update()}addAfterColumn(){this.head.forEach((head,y)=>{head.push(new Cell(head.length,y,"th"))}),this.body.forEach((body,y)=>{body.push(new Cell(body.length,y,"td"))}),this.sortingPosition(),this.saveTable(),this.update()}addRowTop(){const lastOne=this.selected[this.selected.length-1];if(!lastOne){this.logger.error("not selected cell"),alert(MESSAGE.NO_SELECTED_CELL);return}const cellPosY=lastOne.y,type2=lastOne.type,topSideIndex=cellPosY-1>0?cellPosY-1:0;this.addRow(topSideIndex,type2)}addRowBottom(){const lastOne=this.selected[this.selected.length-1];if(!lastOne){this.logger.error("not selected cell"),alert(MESSAGE.NO_SELECTED_CELL);return}const cellPosY=lastOne.y,type2=lastOne.type,bottomSideIndex=cellPosY+1;this.addRow(bottomSideIndex,type2)}addRow(index,type2){type2==="th"?this.addRowHead(index):this.addRowBody(index),this.sortingPosition(),this.saveTable(),this.update()}addRowHead(index){this.head.splice(index,0,[...new Array(this.head[0].length)].map((_,i)=>new Cell(i,index,"th")))}addRowBody(index){this.body.splice(index,0,[...new Array(this.body[0].length)].map((_,i)=>new Cell(i,index,"td")))}addRowHeadTop(){this.head.splice(0,0,[...new Array(this.head[0].length)].map((_,i)=>new Cell(i,0,"th"))),this.sortingPosition(),this.saveTable(),this.update()}addRowHeadBottom(){this.head.push([...new Array(this.head[this.head.length-1].length)].map((_,i)=>new Cell(i,this.head.length,"th"))),this.sortingPosition(),this.saveTable(),this.update()}addRowBodyTop(){this.body.splice(0,0,[...new Array(this.body[0].length)].map((_,i)=>new Cell(i,0,"td"))),this.sortingPosition(),this.saveTable(),this.update()}addRowBodyBottom(){this.body.push([...new Array(this.body[this.body.length-1].length)].map((_,i)=>new Cell(i,this.body.length,"td"))),this.sortingPosition(),this.saveTable(),this.update()}removeContent(){this.selected.forEach(cell=>{cell.content=""}),this.sortingPosition(),this.saveTable(),this.update()}removeStyle(){this.selected.forEach(cell=>{cell.style={}}),this.sortingPosition(),this.saveTable(),this.update()}removeRow(){const deniedMsg=new Set,rowSet=this.selected.reduce((acc,cell)=>(cell.type in acc||(acc[cell.type]=new Set),acc[cell.type].add(cell.y),acc),{});if("th"in rowSet)if(this.head.length>1&&rowSet.th.size<this.head.length){const sorted=[...rowSet.th].toSorted((a,b)=>a-b);let count=0;for(const row of sorted)this.head.splice(row-count,1),count+=1;this.logger.check("processed: (deleted header row amount) "+count)}else deniedMsg.add("헤드");if("td"in rowSet)if(this.body.length>1&&rowSet.td.size<this.body.length){const sorted=[...rowSet.td].toSorted((a,b)=>a-b);let count=0;for(const row of sorted)this.body.splice(row-count,1),count+=1;this.logger.check("processed: (deleted body row amount) "+count)}else deniedMsg.add("바디");deniedMsg.size>0&&alert(`[${[...deniedMsg].join(", ")}]: `+MESSAGE.REMOVE_COLUMN_DENIED),this.sortingPosition(),this.saveTable(),this.update()}removeColumn(){const columnSet=this.selected.reduce((acc,cell)=>acc.add(cell.x),new Set);this.head[0].length>1&&this.body[0].length>1?columnSet.forEach(x=>{this.head.forEach(row=>{row.splice(x,1)}),this.body.forEach(row=>{row.splice(x,1)})}):alert(MESSAGE.REMOVE_COLUMN_DENIED),this.sortingPosition(),this.saveTable(),this.update()}getSelectedMinCell(){let minX=1/0,minY=1/0,min=null;return this.selected.forEach(cell=>{(cell.posX<minX||cell.posY<minY)&&(minX=cell.posX,minY=cell.posY,min=cell)}),min}getSelectedMaxCell(){let maxX=0,maxY=0,max=null;return this.selected.forEach(cell=>{(cell.posX>maxX||cell.posY>maxY)&&(maxX=cell.posX,maxY=cell.posY,max=cell)}),max}getSelectedAsGroup(){const groups=[];for(let i=0;i<this.selected.length;i++){if(groups.length===0){groups.push([this.selected[i]]);continue}const cur=this.selected[i],next=this.selected[i+1];next&&(cur.id+1===next.id||cur.id+this[cur.type==="th"?"head":"body"][0].length===next.id)&&groups[groups.length-1].push(cur,next)}return groups}concatAll(){const min=this.getSelectedMinCell(),max=this.getSelectedMaxCell();if(!min&&!max&&alert(MESSAGE.NO_SELECTED_CELL),(min==null?void 0:min.type)!==(max==null?void 0:max.type))return alert(MESSAGE.CANT_CONCAT),!1;if(min&&max){const workArea=this[min.type==="th"?"head":"body"],col=max.posX-min.posX+1,row=max.posY-min.posY+1;min.option.colSpan=col,min.option.rowSpan=row;for(let r=min.y;r<=min.y+row-1;r++)for(let c=min.x;c<=min.x+col-1;c++)r===min.y&&c===min.x?(workArea[r][c].option.colSpan=col,workArea[r][c].option.rowSpan=row):workArea[r][c].option.hidden=!0}this.saveTable(),this.update()}splitCell(){const min=this.getSelectedMinCell(),max=this.getSelectedMaxCell();if(!min&&!max&&alert(MESSAGE.NO_SELECTED_CELL),(min==null?void 0:min.type)!==(max==null?void 0:max.type))return alert(MESSAGE.CANT_SPLIT),!1;if(min&&max)if(min===max){const workArea=this[min.type==="th"?"head":"body"],col=min.option.colSpan,row=min.option.rowSpan;for(let r=min.y;r<=min.y+row-1;r++)for(let c=min.x;c<=min.x+col-1;c++)workArea[r][c].option={}}else{const workArea=this[min.type==="th"?"head":"body"],col=max.posX-min.posX+1,row=max.posY-min.posY+1;min.option.colSpan=col,min.option.rowSpan=col;for(let r=min.y;r<=min.y+row-1;r++)for(let c=min.x;c<=min.x+col-1;c++)workArea[r][c].option={}}this.saveTable(),this.update()}tableLayoutFixed(){this.options.tableLayout="fixed",this.saveTable(),this.update()}tableLayoutAuto(){this.options.tableLayout="auto",this.saveTable(),this.update()}drawBorderTop(){const dir=this.selected.every(cell=>cell.hasBorder("top"));for(const cell of this.selected)dir?(cell.removeStyle("borderTopWidth"),cell.removeStyle("borderTopStyle"),cell.removeStyle("borderTopColor")):(cell.style.borderTopWidth="1px",cell.style.borderTopStyle="solid",cell.style.borderTopColor="black")}drawBorderBottom(){const dir=this.selected.every(cell=>cell.hasBorder("bottom"));for(const cell of this.selected)dir?(cell.removeStyle("borderBottomWidth"),cell.removeStyle("borderBottomStyle"),cell.removeStyle("borderBottomColor")):(cell.style.borderBottomWidth="1px",cell.style.borderBottomStyle="solid",cell.style.borderBottomColor="black")}drawBorderLeft(){const dir=this.selected.every(cell=>cell.hasBorder("left"));for(const cell of this.selected)dir?(cell.removeStyle("borderLeftWidth"),cell.removeStyle("borderLeftStyle"),cell.removeStyle("borderLeftColor")):(cell.style.borderLeftWidth="1px",cell.style.borderLeftStyle="solid",cell.style.borderLeftColor="black")}drawBorderRight(){const dir=this.selected.every(cell=>cell.hasBorder("right"));for(const cell of this.selected)dir?(cell.removeStyle("borderRightWidth"),cell.removeStyle("borderRightStyle"),cell.removeStyle("borderRightColor")):(cell.style.borderRightWidth="1px",cell.style.borderRightStyle="solid",cell.style.borderRightColor="black")}drawBorderAll(){const dir=this.selected.every(cell=>cell.hasBorder("top")&&cell.hasBorder("bottom")&&cell.hasBorder("left")&&cell.hasBorder("right"));for(const cell of this.selected)dir?(cell.removeStyle("borderTopWidth"),cell.removeStyle("borderTopStyle"),cell.removeStyle("borderTopColor"),cell.removeStyle("borderBottomWidth"),cell.removeStyle("borderBottomStyle"),cell.removeStyle("borderBottomColor"),cell.removeStyle("borderLeftWidth"),cell.removeStyle("borderLeftStyle"),cell.removeStyle("borderLeftColor"),cell.removeStyle("borderRightWidth"),cell.removeStyle("borderRightStyle"),cell.removeStyle("borderRightColor")):(cell.style.borderTopWidth="1px",cell.style.borderTopStyle="solid",cell.style.borderTopColor="black",cell.style.borderBottomWidth="1px",cell.style.borderBottomStyle="solid",cell.style.borderBottomColor="black",cell.style.borderLeftWidth="1px",cell.style.borderLeftStyle="solid",cell.style.borderLeftColor="black",cell.style.borderRightWidth="1px",cell.style.borderRightStyle="solid",cell.style.borderRightColor="black")}exportHTML(){const blob=new Blob([this.table.outerHTML],{type:"text/html"}),a=document.createElement("a"),url=URL.createObjectURL(blob);a.href=url,a.download="gantt-chart.html",a.hidden=!0,document.body.append(a),a.click(),a.remove(),URL.revokeObjectURL(url)}};__name(_TableManager,"TableManager");let TableManager=_TableManager;const _PanelManager=class _PanelManager extends BaseModule{constructor(){super();__publicField(this,"menuList",{common:[]});__publicField(this,"menuName","common");__publicField(this,"currentMenu",[]);__publicField(this,"width","450px");__publicField(this,"previewColor",{r:56,g:125,b:36,a:255});this.menuList.common.push({title:"기본 스타일",item:[{title:"셀 비우기 옵션",panel:`
        <div class="cell-concat-options">
          <button class="" data-cell-feature="remove-style">스타일 제거</button>
          <button class="" data-cell-feature="remove-content">내용 제거</button>
        </div>
      `},{title:"셀 추가 옵션",panel:`
        <div class="cell-concat-options">
          <button class="" data-cell-add="left"><box-icon name='left-arrow-alt'></box-icon></button>
          <button class="" data-cell-add="right"><box-icon name='right-arrow-alt'></box-icon></button>
          <button class="" data-cell-add="top"><box-icon name='up-arrow-alt'></box-icon></button>
          <button class="" data-cell-add="bottom"><box-icon name='down-arrow-alt'></box-icon></button>
        </div>
      `},{title:"셀 제거 옵션",panel:`
        <div class="cell-concat-options">
          <button class="" data-cell-remove="row"><box-icon name='move-horizontal'></box-icon></button>
          <button class="" data-cell-remove="column"><box-icon name='move-vertical'></box-icon></button>
        </div>
      `},{title:"셀 혼합 옵션",panel:`
        <div class="cell-concat-options">
          <button class="cell-concat-button" data-dir="all">concat</button>
          <button class="cell-concat-button" data-dir="split">split</button>
        </div>
      `},{title:"셀 사이즈 옵션",panel:`
        <div class="cell-concat-options">
          <label>width
            <input name="width" type="number" min="-1" step="0.1" />
          </label>
          <label>height
            <input name="height" type="number" min="-1" step="0.1" />
          </label>
        </div>
      `},{title:"색상 조절",panel:`
        <div>preview</div>
        <div id="preview-color"></div>
        <div class="palette">
          <input class="total" name="rgba" type="color" rgba />
          <input class="rgba" name="r" type="range" min="0" max="255" />
          <input class="rgba" name="g" type="range" min="0" max="255" />
          <input class="rgba" name="b" type="range" min="0" max="255" />
          <input class="rgba" name="a" type="range" min="0" max="255" />
        </div>
      `},{title:"테두리 그리기 제어",panel:`
        <div>border</div>
        <div class="border-onoff">
          <label>
            <input name="border-switch-top" data-border-check="top" type="checkbox"></input>
            top
          </label>
          <div class="centered">
            <label>
              <input name="border-switch-left" data-border-check="left" type="checkbox"></input>
              left
            </label>
              <label>
                <input name="border-switch-all" data-border-check="all" type="checkbox"></input>
                all
              </label>
              <label>
                <input name="border-switch-right" data-border-check="right" type="checkbox"></input>
                right
              </label>
          </div>
          <label>
            <input name="border-switch-bottom" data-border-check="bottom" type="checkbox"></input>
            bottom
          </label>
        </div>
      `}]})}setWidth(width){this.width=width}setCurrentMenu(menu){this.menuName=menu,this.loadMenu()}initialize(){this.logger.process("initialize panel manager"),this.loadMenu(),this.update()}loadMenu(){this.currentMenu=this.menuList[this.menuName]}openPanel(){this.previewUpdate(),this.dependencies.Ui.openPanel(this.width)}updateInputBar(){const rgbaTool=document.querySelector(".palette");if(rgbaTool){const r=rgbaTool.querySelector('[name="r"]'),g=rgbaTool.querySelector('[name="g"]'),b=rgbaTool.querySelector('[name="b"]'),a=rgbaTool.querySelector('[name="a"]');r.value=""+this.previewColor.r,g.value=""+this.previewColor.g,b.value=""+this.previewColor.b,a.value=""+this.previewColor.a}}closePanel(){this.dependencies.Ui.closePanel()}isOpened(){return PANEL.classList.contains("open")}isOpenedSheetTool(){return!!document.querySelector("#sheet-tool")}clearPanel(){PANEL.innerHTML=""}initializeSizeOptions(){var _a,_b;const defaultValue="0px";if(this.dependencies.TableManager.selected.length===0)return;const cell=this.dependencies.TableManager.selected[0],widthInput=document.querySelector("input[name='width']"),heightInput=document.querySelector("input[name='height']");widthInput&&(widthInput.value=""+Number((_a=(""+(cell.style.width==="auto"?defaultValue:cell.style.width||defaultValue)).match(/[0-9]+/g))==null?void 0:_a[0])),heightInput&&(heightInput.value=""+Number((_b=(""+(cell.style.height==="auto"?defaultValue:cell.style.height||defaultValue)).match(/[0-9]+/g))==null?void 0:_b[0]))}initializeCellBackgroudColorSet(){const defaultColor="#00000000",bgMap=this.dependencies.TableManager.selected.map(cell=>cell.style.backgroundColor||defaultColor),keyArray=[],countArray=[];[...new Set(bgMap)].forEach(bg=>{keyArray.push(bg),countArray.push(0)});for(const bg of bgMap)countArray[keyArray.indexOf(bg)]+=1;const sorted=[...keyArray].sort((a,b)=>countArray[keyArray.indexOf(b)]-countArray[keyArray.indexOf(a)]),initialColor=(sorted[0]===defaultColor?sorted[1]:sorted[0])||defaultColor;this.previewColor=this.parseHexToRGBA(initialColor)}initializeCellBorders(){const inputs=document.querySelectorAll('[name="border-switch-top"],[name="border-switch-bottom"],[name="border-switch-left"],[name="border-switch-right"],[name="border-switch-all"]'),dirs=document.querySelectorAll('[name="border-switch-top"],[name="border-switch-bottom"],[name="border-switch-left"],[name="border-switch-right"]'),allInput=document.querySelector('[name="border-switch-all"]');inputs.forEach(input2=>{input2.checked=!1});const input=__name(key=>document.querySelector(`[name="border-switch-${key}"]`),"input"),cells=this.dependencies.TableManager.selected,isActivated={top:0,bottom:0,left:0,right:0,all:0};for(const cell of cells){const hasTop=cell.hasBorder("top"),hasBottom=cell.hasBorder("bottom"),hasLeft=cell.hasBorder("left"),hasRight=cell.hasBorder("right");hasTop&&hasBottom&&hasLeft&&hasRight&&(isActivated.all+=1),hasTop&&(isActivated.top+=1),hasBottom&&(isActivated.bottom+=1),hasLeft&&(isActivated.left+=1),hasRight&&(isActivated.right+=1)}const max=Math.max(...Object.values(isActivated));Object.entries(isActivated).forEach(([key,value])=>{value>max/2&&(input(key).checked=!0)}),[...dirs].every(dir=>!!dir.checked)?allInput.checked=!0:allInput.checked=!1}parseHexToRGB(hex){const[r,g,b]=hex.slice(1).replace(/\B(?=(.{2})+(?!.))/g," ").split(" ");return{r:parseInt(r,16),g:parseInt(g,16),b:parseInt(b,16),a:255}}parseHexToRGBA(hex){const[r,g,b,a]=hex.slice(1).replace(/\B(?=(.{2})+(?!.))/g," ").split(" ");return{r:parseInt(r,16),g:parseInt(g,16),b:parseInt(b,16),a:parseInt(a,16)}}previewUpdate(){const previewColor=document.querySelector("#preview-color");previewColor.style.boxShadow="inset 0 0 0 99999999999px"+this.getBackgroundColor(),this.updateInputBar()}getBackgroundColor(){const{r,g,b,a}=this.previewColor;return`#${this.convertHex(r)}${this.convertHex(g)}${this.convertHex(b)}${this.convertHex(a)}`}convertHex(value){return parseInt(""+value).toString(16).padStart(2,"0")}update(){this.logger.debug("update panel"),this.clearPanel();const menuWrap=this.createEl("div");menuWrap.classList.add("menu-wrap"),this.currentMenu.forEach(menu=>{const title=this.createEl("div");title.classList.add("menu-title"),title.innerText=menu.title,menuWrap.append(title);const menuList=this.createEl("div");menuList.classList.add("menu-list"),menu.item.forEach(item=>{const menu2=this.createEl("div");menu2.classList.add("panel");const menuTitle=this.createEl("div");if(menuTitle.classList.add("panel-title"),menuTitle.innerText=item.title,item.panel instanceof HTMLElement)item.panel.classList.add("panel-tool");else{const els=[...new DOMParser().parseFromString(item.panel,"text/html").body.children];item.panel=this.createEl("div"),item.panel.append(...els)}menu2.append(menuTitle),menu2.append(item.panel),menuList.append(menu2)}),menuWrap.append(menuList)}),PANEL.append(menuWrap)}};__name(_PanelManager,"PanelManager");let PanelManager=_PanelManager;const _GanttChart=class _GanttChart extends BaseModule{constructor(){super();__publicField(this,"ui");__publicField(this,"tableManager");__publicField(this,"menuManager");__publicField(this,"toolManager");__publicField(this,"panelManager");__publicField(this,"storageManager");__publicField(this,"eventManager");this.logger.process("load modules..."),this.ui=new Ui,this.tableManager=new TableManager,this.menuManager=new MenuManager,this.toolManager=new ToolManager,this.panelManager=new PanelManager,this.storageManager=new StorageManager,this.eventManager=new EventManager,this.logger.process("load sub modules for each modules..."),this.eventManager.bulkInjection([this.ui,this.tableManager,this.menuManager,this.panelManager,this.toolManager,this.storageManager]),this.ui.bulkInjection([this.toolManager,this.tableManager,this.menuManager,this.storageManager]),this.tableManager.bulkInjection([this.ui,this.toolManager,this.storageManager]),this.menuManager.bulkInjection([this.toolManager,this.tableManager,this.storageManager,this.ui]),this.panelManager.bulkInjection([this.toolManager,this.tableManager,this.storageManager,this.menuManager,this.ui]),this.toolManager.bulkInjection([this.ui,this.storageManager,this.tableManager,this.menuManager,this.panelManager]),this.storageManager.bulkInjection([this.ui])}setup(){this.logger.process("setup modules"),this.setupStorage(),this.setupTables(),this.setupEvents(),this.setupPanel(),this.setupMenu(),this.setupUi(),this.logger.debug("✨ ready to play!")}setupTables(){this.tableManager.initialize()}setupEvents(){this.eventManager.initialize()}setupPanel(){this.panelManager.initialize()}setupStorage(){this.storageManager.initialize()}setupMenu(){this.menuManager.initialize()}setupUi(){this.ui.initialize()}};__name(_GanttChart,"GanttChart");let GanttChart=_GanttChart;const gantt=new GanttChart;gantt.setup();
